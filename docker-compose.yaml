version: '2'
services:
  app1:
    image: fdrennan/plumber
    command: /app/plumber.R
    volumes:
     - .:/app
    restart: always
    ports:
     - "8000:8000"
  app2:
    image: fdrennan/plumber
    command: /app/plumber.R
    volumes:
     - .:/app
    restart: always
    ports:
     - "8001:8000"
  rstudio:
    image: rocker/rstudio
    volumes:
     - .:/app
    restart: always
    ports:
     - "8787:8787"
  nginx:
      image: nginx:1.9
      ports:
       - "80:80"
      volumes:
       - ./nginx.conf:/etc/nginx/nginx.conf:ro
      restart: always
      depends_on:
       - app1
       - app2
  lb:
      image: 'dockercloud/haproxy:1.2.1'
      links:
       - app1
      volumes:
        - /var/run/docker.sock:/var/run/docker.sock